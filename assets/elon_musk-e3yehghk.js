import{g as f,m as U,_ as x,r as I,h as O,v as S,o as g,c as m,a as u,n as y,f as R,i as B,t as j,e as $,j as T,k as H}from"./index-B55ARYoC.js";import{o as P,c as z,d as b,e as D,f as E,g as G}from"./opencv-helpers-CGV3UA24.js";class _{pressedKeys={};constructor(){}static get Instance(){return self.inputManager||(self.inputManager=new _().init())}onKeyUpEvents=new Map;onKeyDownEvents=new Map;onKeyDownEventsAny=new Set;mouseDownEvents=new Set;blockKeyboard=!1;clearPressedKeys(){this.pressedKeys={}}setPressedKeys(e){this.pressedKeys=e}mouseListener(e){for(const t of this.mouseDownEvents.values())t(e,e.button===0?"left":"right")}onKeyDown(e){this.blockKeyboard||(this.pressedKeys[e.code]=!0,this.trigger(e,0),this.triggerAny(e))}onKeyUp(e){this.pressedKeys[e.code]=!1,this.trigger(e,1)}init(){const e=this.onKeyDown.bind(this),t=this.onKeyUp.bind(this);return document.addEventListener("keydown",e),document.addEventListener("keyup",t),this}getEventListByType(e){switch(e){case 0:return this.onKeyDownEvents;case 1:return this.onKeyUpEvents}}triggerAny(e){for(const t of this.onKeyDownEventsAny.values())t(e.code,e)}trigger(e,t){const d=e.code;if(d===void 0)return;const o=this.getEventListByType(t).get(d);if(o!==void 0)for(const n of o.values())n()}removeOnKeyDownEvent(e,t){this.removeListener(0,e,t)}removeOnKeyUpEvent(e,t){this.removeListener(1,e,t)}removeListener(e,t,d){this.getEventListByType(e).get(t)?.delete(d)}addListener(e,t,d){const o=this.getEventListByType(e).get(t);return o?o.add(d):this.getEventListByType(e).set(t,new Set([d])),{removeListener:()=>{this.getEventListByType(e).get(t).delete(d)}}}addKeyUpListener(e,t){return this.addListener(1,e,t)}addKeyDownListenerAny(e){return this.onKeyDownEventsAny.add(e),{removeListener:()=>{this.onKeyDownEventsAny.delete(e)}}}addMouseDownEvent(e){return this.mouseDownEvents.add(e),{removeListener:()=>{this.mouseDownEvents.delete(e)}}}addKeyDownListener(e,t){return this.addListener(0,e,t)}}var M={exports:{}};(function(s,e){(function(t,d){d()})(f,function(){function t(i,r){return typeof r>"u"?r={autoBom:!1}:typeof r!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),r={autoBom:!r}),r.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}function d(i,r,p){var l=new XMLHttpRequest;l.open("GET",i),l.responseType="blob",l.onload=function(){w(l.response,r,p)},l.onerror=function(){console.error("could not download file")},l.send()}function o(i){var r=new XMLHttpRequest;r.open("HEAD",i,!1);try{r.send()}catch{}return 200<=r.status&&299>=r.status}function n(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(r)}}var a=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof f=="object"&&f.global===f?f:void 0,v=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),w=a.saveAs||(typeof window!="object"||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!v?function(i,r,p){var l=a.URL||a.webkitURL,c=document.createElement("a");r=r||i.name||"download",c.download=r,c.rel="noopener",typeof i=="string"?(c.href=i,c.origin===location.origin?n(c):o(c.href)?d(i,r,p):n(c,c.target="_blank")):(c.href=l.createObjectURL(i),setTimeout(function(){l.revokeObjectURL(c.href)},4e4),setTimeout(function(){n(c)},0))}:"msSaveOrOpenBlob"in navigator?function(i,r,p){if(r=r||i.name||"download",typeof i!="string")navigator.msSaveOrOpenBlob(t(i,p),r);else if(o(i))d(i,r,p);else{var l=document.createElement("a");l.href=i,l.target="_blank",setTimeout(function(){n(l)})}}:function(i,r,p,l){if(l=l||open("","_blank"),l&&(l.document.title=l.document.body.innerText="downloading..."),typeof i=="string")return d(i,r,p);var c=i.type==="application/octet-stream",F=/constructor/i.test(a.HTMLElement)||a.safari,C=/CriOS\/[\d]+/.test(navigator.userAgent);if((C||c&&F||v)&&typeof FileReader<"u"){var k=new FileReader;k.onloadend=function(){var h=k.result;h=C?h:h.replace(/^data:[^;]*;/,"data:attachment/file;"),l?l.location.href=h:location=h,l=null},k.readAsDataURL(i)}else{var K=a.URL||a.webkitURL,L=K.createObjectURL(i);l?l.location=L:location.href=L,l=null,setTimeout(function(){K.revokeObjectURL(L)},4e4)}});a.saveAs=w.saveAs=w,s.exports=w})})(M);var A=M.exports;const X={data(){return{brushType:"del",imageHolder:U({originalImage:P.Mat}),checkpoints:Array(),isDrawing:!1,ctrlZEvent:void 0,haveImage:!1}},unmounted(){this.ctrlZEvent?.removeListener?.()},mounted(){this.ctrlZEvent=_.Instance.addKeyDownListenerAny((s,e)=>{s==="KeyZ"&&e.ctrlKey&&this.revertLastOp()}),this.enableDraw()},methods:{saveFromPreview(){const s=this.$refs.preview;A.saveAs(s.src,"image.png")},save(){this.$refs.outputCanvas.toBlob(s=>{A.saveAs(s,"image")})},revertLastOp(){const s=this.checkpoints.pop();if(!s)return;const e=this.$refs.maskCanvas,t=e.getContext("2d",{willReadFrequently:!0});t.clearRect(0,0,e.width,e.height),t.putImageData(s,0,0),this.updateBlend()},enableDraw(){if(this.$root.$isMobile())return;const s=this.$refs.maskCanvas,e=this.$refs.outputCanvas,t=s.getContext("2d",{willReadFrequently:!0});let d=0,o=0;e.addEventListener("mousedown",n=>{if(this.$refs["canvas-holder"].focus(),n.preventDefault(),n.which!==1)return;this.isDrawing=!0;const a=t.getImageData(0,0,e.width,e.height);this.checkpoints.push(a),this.checkpoints.length>15&&this.checkpoints.shift(),[d,o]=[n.offsetX,n.offsetY]}),e.addEventListener("mousemove",n=>{this.isDrawing&&(this.$refs["canvas-holder"].focus(),t.beginPath(),t.moveTo(d,o),t.lineTo(n.offsetX,n.offsetY),t.strokeStyle=this.brushType=="del"?"black":"white",t.lineWidth=8,t.lineCap="round",t.stroke(),this.updateBlend(),[d,o]=[n.offsetX,n.offsetY])}),e.addEventListener("mouseup",()=>{this.isDrawing=!1}),s.addEventListener("mouseout",()=>{this.isDrawing=!1})},updateBlend(){if(this.haveImage)try{const s=z(this.$refs.maskCanvas,"float32");b.blur(s,s,new b.Size(2,2));const e=D(this.imageHolder.originalImage,s);E(this.$refs.outputCanvas,e),e.delete(),s.delete()}catch(s){alert(String(s?.message||s)),console.error(s)}},previewImage(s){const e=D(this.imageHolder.originalImage,s);b.cvtColor(e,e,b.COLOR_BGRA2RGBA);const t=G(e);this.$refs.preview.src=t,e.delete()},setImage(s,e){if(this.checkpoints=[],this.isDrawing=!1,this.imageHolder?.originalImage?.delete?.(),this.haveImage=!0,this.imageHolder.originalImage=s,this.$root.$isMobile()){this.previewImage(e),e.delete();return}const t=this.$refs.outputCanvas,d=this.$refs.maskCanvas,o=D(s,e);E(t,o),E(d,e),o.delete(),e.delete()}},props:{}},V={class:"align-self-center"},q={key:0},Y={class:"p-3 border-round-2xl col-11 md:col-5 align-items-center m-auto shadow-3",style:{background:"white",border:"solid 1.2px #e1e1e1"}},Z={class:"flex justify-content-center",style:{gap:"15px"}},N={class:"no-drag-no-select",ref:"outputCanvas"},W={class:"no-drag-no-select",style:{display:"none"},ref:"maskCanvas"},J={key:1},Q={ref:"preview",style:{width:"500px",height:"500px",background:"url('./images/download.png')","object-fit":"scale-down"}};function ee(s,e,t,d,o,n){const a=I("Button");return O((g(),m("div",V,[e[6]||(e[6]=u("div",{class:"py-2"},null,-1)),s.$root.$isMobile()?(g(),m("div",J,[u("img",Q,null,512),e[5]||(e[5]=u("div",{class:"py-2"},null,-1)),R(a,{label:"Save",size:"large",onClick:n.saveFromPreview,class:"border-round-2xl",icon:"pi pi-save"},null,8,["onClick"])])):(g(),m("div",q,[u("div",Y,[u("div",Z,[u("div",null,[u("i",{onClick:e[0]||(e[0]=v=>{o.brushType="del",o.isDrawing=!1}),style:y([o.brushType=="del"?"color:blue":"",{"font-size":"x-large"}]),class:"pi pi-eraser cursor-pointer"},null,4)]),u("div",null,[u("i",{onClick:e[1]||(e[1]=v=>{o.brushType="paint",o.isDrawing=!1}),style:y([o.brushType!="del"?"color:blue":"",{"font-size":"x-large"}]),class:"pi pi-pencil cursor-pointer"},null,4)]),u("div",null,[u("i",{style:y([o.checkpoints.length>0?"cursor:pointer":"",{"font-size":"x-large"}]),onClick:e[2]||(e[2]=(...v)=>n.revertLastOp&&n.revertLastOp(...v)),class:"pi pi-undo"},null,4)]),u("div",null,[u("i",{style:{"font-size":"x-large"},onClick:e[3]||(e[3]=(...v)=>n.save&&n.save(...v)),class:"pi pi-save cursor-pointer"})])])]),e[4]||(e[4]=u("div",{class:"py-1"},null,-1)),u("div",{ref:"canvas-holder",style:y([{overflow:"auto",position:"relative","min-height":"500px",background:"url('./images/download.png')"},s.$root.$grid.lg?"width:84vw":"width:100vw"]),class:"border-round-2xl shadow-1"},[u("canvas",N,null,512),u("canvas",W,null,512)],4)]))],512)),[[S,o.haveImage]])}const ue=x(X,[["render",ee]]),te={data(){return{status:"",val:0,show:!1}},unmounted(){B.Instance.unsubscribeEmitter("modelLoading")},mounted(){B.Instance.subscribeEmitter("modelLoading",(s,e)=>{switch(s){case"download":{this.show=!0,this.val=Math.trunc(parseFloat(e)),this.status="Downloading model..";break}case"message":{this.status=e;break}case"finish":{this.show=!1;break}}})}},se={key:0,class:"overlay"},ne={class:"inner-overlay col-11 md:col-7 p-4",style:{height:"70vh",border:"2px solid black",background:"white","border-radius":"15px"}},oe={style:{"font-weight":"bold"}};function ie(s,e,t,d,o,n){const a=I("ProgressBar");return o.show?(g(),m("div",se,[u("div",ne,[u("p",oe,j(o.status),1),e[0]||(e[0]=u("div",{class:"py-1"},null,-1)),R(a,{style:{height:"30px","border-radius":"20px"},value:o.val},null,8,["value"])])])):$("",!0)}const ce=x(te,[["render",ie],["__scopeId","data-v-2334895f"]]),re={data(){return{isDragging:!1}},emits:["onFile"],methods:{triggerFileInput(){this.$refs.fileInput.click()},handleFiles(s){let e;"dataTransfer"in s?e=s.dataTransfer.files[0]:(e=s.target.files[0],this.$refs.fileInput.value=""),e&&this.$emit("onFile",e)},dragOver(){this.isDragging=!0},dragLeave(){this.isDragging=!1},handleDrop(s){this.isDragging=!1,this.handleFiles(s)}}};function ae(s,e,t,d,o,n){return g(),m("div",null,[u("input",{type:"file",ref:"fileInput",onChange:e[0]||(e[0]=(...a)=>n.handleFiles&&n.handleFiles(...a)),accept:"image/*",style:{display:"none"}},null,544),u("div",{id:"drop-area",onClick:e[1]||(e[1]=(...a)=>n.triggerFileInput&&n.triggerFileInput(...a)),onDragover:e[2]||(e[2]=T((...a)=>n.dragOver&&n.dragOver(...a),["prevent"])),onDragleave:e[3]||(e[3]=(...a)=>n.dragLeave&&n.dragLeave(...a)),onDrop:e[4]||(e[4]=T((...a)=>n.handleDrop&&n.handleDrop(...a),["prevent"])),class:H({hover:o.isDragging})},e[5]||(e[5]=[u("p",null,"Drag and drop an image here or click to upload",-1)]),34)])}const pe=x(re,[["render",ae]]),ve=""+new URL("../images/008.jpg",import.meta.url).href,he=""+new URL("../images/009.jpg",import.meta.url).href,fe=""+new URL("../images/elon_musk.webp",import.meta.url).href;export{ue as M,ce as P,pe as U,ve as _,he as a,fe as b};
