import{o as S,i as M,c as T,e as B,a as x,b as U,d as $}from"./opencv-helpers-BYc1aFJT.js";import{d as h,m as j,_ as D,w as P,v as H,o as g,c as m,a as u,n as w,e as C,r as b,t as z,f as k,b as A,g as F,h as V,s as G}from"./index-0HoFxIbZ.js";import"./onnxruntime-web-CTuRU3N_.js";class _{pressedKeys={};constructor(){}static get Instance(){return self.inputManager||(self.inputManager=new _().init())}onKeyUpEvents=new Map;onKeyDownEvents=new Map;onKeyDownEventsAny=new Set;mouseDownEvents=new Set;blockKeyboard=!1;clearPressedKeys(){this.pressedKeys={}}setPressedKeys(e){this.pressedKeys=e}mouseListener(e){for(const t of this.mouseDownEvents.values())t(e,e.button===0?"left":"right")}onKeyDown(e){this.blockKeyboard||(this.pressedKeys[e.code]=!0,this.trigger(e,0),this.triggerAny(e))}onKeyUp(e){this.pressedKeys[e.code]=!1,this.trigger(e,1)}init(){const e=this.onKeyDown.bind(this),t=this.onKeyUp.bind(this);return document.addEventListener("keydown",e),document.addEventListener("keyup",t),this}getEventListByType(e){switch(e){case 0:return this.onKeyDownEvents;case 1:return this.onKeyUpEvents}}triggerAny(e){for(const t of this.onKeyDownEventsAny.values())t(e.code,e)}trigger(e,t){const d=e.code;if(d===void 0)return;const o=this.getEventListByType(t).get(d);if(o!==void 0)for(const n of o.values())n()}removeOnKeyDownEvent(e,t){this.removeListener(0,e,t)}removeOnKeyUpEvent(e,t){this.removeListener(1,e,t)}removeListener(e,t,d){this.getEventListByType(e).get(t)?.delete(d)}addListener(e,t,d){const o=this.getEventListByType(e).get(t);return o?o.add(d):this.getEventListByType(e).set(t,new Set([d])),{removeListener:()=>{this.getEventListByType(e).get(t).delete(d)}}}addKeyUpListener(e,t){return this.addListener(1,e,t)}addKeyDownListenerAny(e){return this.onKeyDownEventsAny.add(e),{removeListener:()=>{this.onKeyDownEventsAny.delete(e)}}}addMouseDownEvent(e){return this.mouseDownEvents.add(e),{removeListener:()=>{this.mouseDownEvents.delete(e)}}}addKeyDownListener(e,t){return this.addListener(0,e,t)}}var O={exports:{}};(function(s,e){(function(t,d){d()})(h,function(){function t(i,a){return typeof a>"u"?a={autoBom:!1}:typeof a!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}function d(i,a,p){var l=new XMLHttpRequest;l.open("GET",i),l.responseType="blob",l.onload=function(){f(l.response,a,p)},l.onerror=function(){console.error("could not download file")},l.send()}function o(i){var a=new XMLHttpRequest;a.open("HEAD",i,!1);try{a.send()}catch{}return 200<=a.status&&299>=a.status}function n(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(a)}}var r=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof h=="object"&&h.global===h?h:void 0,y=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),f=r.saveAs||(typeof window!="object"||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!y?function(i,a,p){var l=r.URL||r.webkitURL,c=document.createElement("a");a=a||i.name||"download",c.download=a,c.rel="noopener",typeof i=="string"?(c.href=i,c.origin===location.origin?n(c):o(c.href)?d(i,a,p):n(c,c.target="_blank")):(c.href=l.createObjectURL(i),setTimeout(function(){l.revokeObjectURL(c.href)},4e4),setTimeout(function(){n(c)},0))}:"msSaveOrOpenBlob"in navigator?function(i,a,p){if(a=a||i.name||"download",typeof i!="string")navigator.msSaveOrOpenBlob(t(i,p),a);else if(o(i))d(i,a,p);else{var l=document.createElement("a");l.href=i,l.target="_blank",setTimeout(function(){n(l)})}}:function(i,a,p,l){if(l=l||open("","_blank"),l&&(l.document.title=l.document.body.innerText="downloading..."),typeof i=="string")return d(i,a,p);var c=i.type==="application/octet-stream",R=/constructor/i.test(r.HTMLElement)||r.safari,K=/CriOS\/[\d]+/.test(navigator.userAgent);if((K||c&&R||y)&&typeof FileReader<"u"){var E=new FileReader;E.onloadend=function(){var v=E.result;v=K?v:v.replace(/^data:[^;]*;/,"data:attachment/file;"),l?l.location.href=v:location=v,l=null},E.readAsDataURL(i)}else{var I=r.URL||r.webkitURL,L=I.createObjectURL(i);l?l.location=L:location.href=L,l=null,setTimeout(function(){I.revokeObjectURL(L)},4e4)}});r.saveAs=f.saveAs=f,s.exports=f})})(O);var X=O.exports;const q={data(){return{brushType:"del",imageHolder:j({originalImage:S.Mat}),checkpoints:Array(),isDrawing:!1,ctrlZEvent:void 0,haveImage:!1}},unmounted(){this.ctrlZEvent?.()},mounted(){this.ctrlZEvent=_.Instance.addKeyDownListenerAny((s,e)=>{s==="KeyZ"&&e.ctrlKey&&this.revertLastOp()}),this.enableDraw()},methods:{save(){this.$refs.outputCanvas.toBlob(s=>{X.saveAs(s,"image")})},revertLastOp(){const s=this.checkpoints.pop();if(!s)return;const e=this.$refs.maskCanvas,t=e.getContext("2d",{willReadFrequently:!0});t.clearRect(0,0,e.width,e.height),t.putImageData(s,0,0),this.updateBlend()},enableDraw(){const s=this.$refs.maskCanvas,e=this.$refs.outputCanvas,t=s.getContext("2d",{willReadFrequently:!0});let d=0,o=0;e.addEventListener("mousedown",n=>{if(this.$refs["canvas-holder"].focus(),n.preventDefault(),n.which!==1)return;this.isDrawing=!0;const r=t.getImageData(0,0,e.width,e.height);this.checkpoints.push(r),this.checkpoints>10&&this.checkpoints.shift(),[d,o]=[n.offsetX,n.offsetY]}),e.addEventListener("mousemove",n=>{this.isDrawing&&(this.$refs["canvas-holder"].focus(),t.beginPath(),t.moveTo(d,o),t.lineTo(n.offsetX,n.offsetY),t.strokeStyle=this.brushType=="del"?"black":"white",t.lineWidth=8,t.lineCap="round",t.stroke(),this.updateBlend(),[d,o]=[n.offsetX,n.offsetY])}),e.addEventListener("mouseup",()=>{this.isDrawing=!1}),s.addEventListener("mouseout",()=>{this.isDrawing=!1})},updateBlend(){if(this.haveImage)try{const s=M(this.$refs.maskCanvas,"float32");T.blur(s,s,new T.Size(2,2));const e=B(this.imageHolder.originalImage,s);x(this.$refs.outputCanvas,e),e.delete(),s.delete()}catch(s){alert(String(s?.message||s)),console.error(s)}},async setImage(s){this.checkpoints=[],this.isDrawing=!1,this.imageHolder?.originalImage?.delete?.();const e=await U(s);this.haveImage=!0,this.imageHolder.originalImage=s;const t=this.$refs.outputCanvas,d=this.$refs.maskCanvas,o=B(s,e);x(t,o),x(d,e),o.delete(),e.delete()}},props:{}},Y={class:"align-self-center"},Z={class:"p-3 border-round-2xl col-11 md:col-5 align-items-center m-auto shadow-3",style:{background:"white",border:"solid 1.2px #e1e1e1"}},N={class:"flex justify-content-center",style:{gap:"15px"}},W={class:"no-drag-no-select",ref:"outputCanvas"},J={class:"no-drag-no-select",style:{display:"none"},ref:"maskCanvas"};function Q(s,e,t,d,o,n){return P((g(),m("div",Y,[e[4]||(e[4]=u("div",{class:"py-2"},null,-1)),u("div",Z,[u("div",N,[u("div",null,[u("i",{onClick:e[0]||(e[0]=r=>{o.brushType="del",o.isDrawing=!1}),style:w([o.brushType=="del"?"color:blue":"",{"font-size":"x-large"}]),class:"pi pi-eraser cursor-pointer"},null,4)]),u("div",null,[u("i",{onClick:e[1]||(e[1]=r=>{o.brushType="paint",o.isDrawing=!1}),style:w([o.brushType!="del"?"color:blue":"",{"font-size":"x-large"}]),class:"pi pi-pencil cursor-pointer"},null,4)]),u("div",null,[u("i",{style:w([o.checkpoints.length>0?"cursor:pointer":"",{"font-size":"x-large"}]),onClick:e[2]||(e[2]=(...r)=>n.revertLastOp&&n.revertLastOp(...r)),class:"pi pi-undo"},null,4)]),u("div",null,[u("i",{style:{"font-size":"x-large"},onClick:e[3]||(e[3]=(...r)=>n.save&&n.save(...r)),class:"pi pi-save cursor-pointer"})])])]),e[5]||(e[5]=u("div",{class:"py-1"},null,-1)),u("div",{ref:"canvas-holder",style:w([{overflow:"auto",position:"relative","min-height":"500px",background:"url('./assets/download.png')"},s.$root.$grid.lg?"width:84vw":"width:100vw"]),class:"border-round-2xl shadow-1"},[u("canvas",W,null,512),u("canvas",J,null,512)],4)],512)),[[H,o.haveImage]])}const ee=D(q,[["render",Q]]),te={data(){return{status:"",val:0,show:!1}},unmounted(){C.Instance.unsubscribeEmitter("modelLoading")},mounted(){C.Instance.subscribeEmitter("modelLoading",(s,e)=>{switch(s){case"download":{this.show=!0,this.val=Math.trunc(parseFloat(e)),this.status="Downloading model..";break}case"message":{this.status=e;break}case"finish":{this.show=!1;break}}})}},se={key:0,class:"overlay"},ne={class:"inner-overlay col-11 md:col-7 p-4",style:{height:"70vh",border:"2px solid black",background:"white","border-radius":"15px"}},oe={style:{"font-weight":"bold"}};function re(s,e,t,d,o,n){const r=b("ProgressBar");return o.show?(g(),m("div",se,[u("div",ne,[u("p",oe,z(o.status),1),e[0]||(e[0]=u("div",{class:"py-1"},null,-1)),k(r,{style:{height:"30px","border-radius":"20px"},value:o.val},null,8,["value"])])])):A("",!0)}const ie=D(te,[["render",re],["__scopeId","data-v-2334895f"]]),ae={data(){return{isDragging:!1}},emits:["onFile"],methods:{triggerFileInput(){this.$refs.fileInput.click()},handleFiles(s){let e;"dataTransfer"in s?e=s.dataTransfer.files[0]:(e=s.target.files[0],this.$refs.fileInput.value=""),e&&this.$emit("onFile",e)},dragOver(){this.isDragging=!0},dragLeave(){this.isDragging=!1},handleDrop(s){this.isDragging=!1,this.handleFiles(s)}}};function le(s,e,t,d,o,n){return g(),m("div",null,[u("input",{type:"file",ref:"fileInput",onChange:e[0]||(e[0]=(...r)=>n.handleFiles&&n.handleFiles(...r)),accept:"image/*",style:{display:"none"}},null,544),u("div",{id:"drop-area",onClick:e[1]||(e[1]=(...r)=>n.triggerFileInput&&n.triggerFileInput(...r)),onDragover:e[2]||(e[2]=F((...r)=>n.dragOver&&n.dragOver(...r),["prevent"])),onDragleave:e[3]||(e[3]=(...r)=>n.dragLeave&&n.dragLeave(...r)),onDrop:e[4]||(e[4]=F((...r)=>n.handleDrop&&n.handleDrop(...r),["prevent"])),class:V({hover:o.isDragging})},e[5]||(e[5]=[u("p",null,"Drag and drop an image here or click to upload",-1)]),34)])}const de=D(ae,[["render",le]]),ue={components:{UploadView:de,ProgressView:ie,MyImage:ee},data(){return{loading:!1}},mounted(){crossOriginIsolated||(console.log("crossOriginIsolated off"),G()||alert("will be slow"))},methods:{async onInputFile(s){this.loading=!0;try{const e=await $(s);await this.$refs.output.setImage(e)}catch(e){throw console.error(e),alert(String(e?.message||e)),e}finally{this.loading=!1}}}},ce={style:{"text-align":"center"}},pe={key:0};function fe(s,e,t,d,o,n){const r=b("upload-view"),y=b("ProgressView"),f=b("my-image");return g(),m("div",ce,[e[1]||(e[1]=u("div",{class:"py-2"},null,-1)),e[2]||(e[2]=u("h4",{class:"text-xl"},"Remove Background",-1)),k(r,{class:"col-11 md:col-7",style:{"margin-inline":"auto"},onOnFile:e[0]||(e[0]=i=>{n.onInputFile(i)})}),k(y),o.loading?(g(),m("p",pe,"Processing..")):A("",!0),k(f,{ref:"output"},null,512)])}const me=D(ue,[["render",fe],["__scopeId","data-v-5c4096bf"]]);export{me as default};
