import{o as v,i as k,c as f,e as p,a as c,b as y,d as I}from"./opencv-helpers-BqfxM2Cw.js";import{m as b,_ as h,r as g,o as d,c as u,a as l,e as _,w,f as C,F as x,s as $,b as B,p as T,d as F}from"./index-CXSgxe5n.js";import"./onnxruntime-web-CTuRU3N_.js";const S={data(){return{brushType:"del",maskAndImage:b({originalImage:v.Mat})}},mounted(){this.enableDraw()},methods:{changeBrush(){this.brushType=this.brushType=="del"?"restore":"del"},enableDraw(){const e=this.$refs.maskCanvas,t=this.$refs.outputCanvas,s=e.getContext("2d",{willReadFrequently:!0});let a=!1,r=0,i=0;t.addEventListener("mousedown",n=>{a=!0,[r,i]=[n.offsetX,n.offsetY]}),t.addEventListener("mousemove",n=>{if(a){s.beginPath(),s.moveTo(r,i),s.lineTo(n.offsetX,n.offsetY),s.strokeStyle=this.brushType=="del"?"black":"white",s.lineWidth=8,s.lineCap="round",s.stroke();try{const o=k(e,"float32");f.blur(o,o,new f.Size(2,2));const m=p(this.maskAndImage.originalImage,o);c(t,m),m.delete(),o.delete()}catch(o){alert(String(o?.message||o)),console.error(o)}[r,i]=[n.offsetX,n.offsetY]}}),t.addEventListener("mouseup",()=>{a=!1}),e.addEventListener("mouseout",()=>{a=!1})},async setImage(e){this.maskAndImage?.originalImage?.delete();const t=await y(e);this.maskAndImage.originalImage=e;const s=this.$refs.outputCanvas,a=this.$refs.maskCanvas,r=p(e,t);c(s,r),c(a,t),r.delete(),t.delete()}},props:{}},A={class:"align-self-center"},E={ref:"outputCanvas"},G={style:{display:"none"},ref:"maskCanvas"};function L(e,t,s,a,r,i){const n=g("Button");return d(),u(x,null,[l("div",A,[l("canvas",E,null,512),l("canvas",G,null,512)]),_(n,{onClick:i.changeBrush},{default:w(()=>[C("change brush")]),_:1},8,["onClick"])],64)}const M=h(S,[["render",L]]),N={components:{MyImage:M},data(){return{loading:!1,img_src:void 0}},mounted(){crossOriginIsolated||(console.log("crossOriginIsolated off"),$()||alert("will be slow"))},methods:{async onInputFile(e){const t=e.target,s=t.files[0];if(s){t.value="",this.loading=!0;try{const a=await I(s);await this.$refs.output.setImage(a)}catch(a){throw alert(String(a?.message||a)),a}finally{this.loading=!1}}}}},R=e=>(T("data-v-3f49acab"),e=e(),F(),e),V={style:{"text-align":"center"}},X=R(()=>l("h4",{class:"text-xl"},"App",-1)),Y={key:0};function D(e,t,s,a,r,i){const n=g("my-image");return d(),u("div",V,[X,l("input",{onChange:t[0]||(t[0]=(...o)=>i.onInputFile&&i.onInputFile(...o)),type:"file"},null,32),_(n,{ref:"output"},null,512),r.loading?(d(),u("p",Y,"loading")):B("",!0)])}const z=h(N,[["render",D],["__scopeId","data-v-3f49acab"]]);export{z as default};
