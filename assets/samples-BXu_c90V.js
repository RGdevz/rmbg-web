import{g as m,m as F,_ as k,r as $,h as j,v as U,o as h,c as f,a as l,n as y,f as A,i as K,t as S,e as O,j as B,k as H,l as P}from"./index-BpQvI-0Z.js";import{o as z,c as G,d as b,e as x,f as E,g as X}from"./opencv-helpers-Fku369FT.js";class C{pressedKeys={};constructor(){}static get Instance(){return self.inputManager||(self.inputManager=new C().init())}onKeyUpEvents=new Map;onKeyDownEvents=new Map;onKeyDownEventsAny=new Set;mouseDownEvents=new Set;blockKeyboard=!1;clearPressedKeys(){this.pressedKeys={}}setPressedKeys(e){this.pressedKeys=e}mouseListener(e){for(const s of this.mouseDownEvents.values())s(e,e.button===0?"left":"right")}onKeyDown(e){this.blockKeyboard||(this.pressedKeys[e.code]=!0,this.trigger(e,0),this.triggerAny(e))}onKeyUp(e){this.pressedKeys[e.code]=!1,this.trigger(e,1)}init(){const e=this.onKeyDown.bind(this),s=this.onKeyUp.bind(this);return document.addEventListener("keydown",e),document.addEventListener("keyup",s),this}getEventListByType(e){switch(e){case 0:return this.onKeyDownEvents;case 1:return this.onKeyUpEvents}}triggerAny(e){for(const s of this.onKeyDownEventsAny.values())s(e.code,e)}trigger(e,s){const c=e.code;if(c===void 0)return;const r=this.getEventListByType(s).get(c);if(r!==void 0)for(const n of r.values())n()}removeOnKeyDownEvent(e,s){this.removeListener(0,e,s)}removeOnKeyUpEvent(e,s){this.removeListener(1,e,s)}removeListener(e,s,c){this.getEventListByType(e).get(s)?.delete(c)}addListener(e,s,c){const r=this.getEventListByType(e).get(s);return r?r.add(c):this.getEventListByType(e).set(s,new Set([c])),{removeListener:()=>{this.getEventListByType(e).get(s).delete(c)}}}addKeyUpListener(e,s){return this.addListener(1,e,s)}addKeyDownListenerAny(e){return this.onKeyDownEventsAny.add(e),{removeListener:()=>{this.onKeyDownEventsAny.delete(e)}}}addMouseDownEvent(e){return this.mouseDownEvents.add(e),{removeListener:()=>{this.mouseDownEvents.delete(e)}}}addKeyDownListener(e,s){return this.addListener(0,e,s)}}var R={exports:{}};(function(t,e){(function(s,c){c()})(m,function(){function s(i,a){return typeof a>"u"?a={autoBom:!1}:typeof a!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}function c(i,a,p){var d=new XMLHttpRequest;d.open("GET",i),d.responseType="blob",d.onload=function(){w(d.response,a,p)},d.onerror=function(){console.error("could not download file")},d.send()}function r(i){var a=new XMLHttpRequest;a.open("HEAD",i,!1);try{a.send()}catch{}return 200<=a.status&&299>=a.status}function n(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(a)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof m=="object"&&m.global===m?m:void 0,v=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),w=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!v?function(i,a,p){var d=o.URL||o.webkitURL,u=document.createElement("a");a=a||i.name||"download",u.download=a,u.rel="noopener",typeof i=="string"?(u.href=i,u.origin===location.origin?n(u):r(u.href)?c(i,a,p):n(u,u.target="_blank")):(u.href=d.createObjectURL(i),setTimeout(function(){d.revokeObjectURL(u.href)},4e4),setTimeout(function(){n(u)},0))}:"msSaveOrOpenBlob"in navigator?function(i,a,p){if(a=a||i.name||"download",typeof i!="string")navigator.msSaveOrOpenBlob(s(i,p),a);else if(r(i))c(i,a,p);else{var d=document.createElement("a");d.href=i,d.target="_blank",setTimeout(function(){n(d)})}}:function(i,a,p,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),typeof i=="string")return c(i,a,p);var u=i.type==="application/octet-stream",M=/constructor/i.test(o.HTMLElement)||o.safari,_=/CriOS\/[\d]+/.test(navigator.userAgent);if((_||u&&M||v)&&typeof FileReader<"u"){var L=new FileReader;L.onloadend=function(){var g=L.result;g=_?g:g.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=g:location=g,d=null},L.readAsDataURL(i)}else{var I=o.URL||o.webkitURL,D=I.createObjectURL(i);d?d.location=D:location.href=D,d=null,setTimeout(function(){I.revokeObjectURL(D)},4e4)}});o.saveAs=w.saveAs=w,t.exports=w})})(R);var T=R.exports;const V={data(){return{brushType:"del",imageHolder:F({originalImage:z.Mat}),checkpoints:Array(),isDrawing:!1,ctrlZEvent:void 0,haveImage:!1}},unmounted(){this.ctrlZEvent?.removeListener?.()},mounted(){this.ctrlZEvent=C.Instance.addKeyDownListenerAny((t,e)=>{t==="KeyZ"&&e.ctrlKey&&this.revertLastOp()}),this.enableDraw()},methods:{saveFromPreview(){const t=this.$refs.preview;T.saveAs(t.src,"image.png")},save(){this.$refs.outputCanvas.toBlob(t=>{T.saveAs(t,"image")})},revertLastOp(){const t=this.checkpoints.pop();if(!t)return;const e=this.$refs.maskCanvas,s=e.getContext("2d",{willReadFrequently:!0});s.clearRect(0,0,e.width,e.height),s.putImageData(t,0,0),this.updateBlend()},enableDraw(){if(this.$root.$isMobile())return;const t=this.$refs.maskCanvas,e=this.$refs.outputCanvas,s=t.getContext("2d",{willReadFrequently:!0});let c=0,r=0;e.addEventListener("mousedown",n=>{if(this.$refs["canvas-holder"].focus(),n.preventDefault(),n.which!==1)return;this.isDrawing=!0;const o=s.getImageData(0,0,e.width,e.height);this.checkpoints.push(o),this.checkpoints.length>15&&this.checkpoints.shift(),[c,r]=[n.offsetX,n.offsetY]}),e.addEventListener("mousemove",n=>{this.isDrawing&&(this.$refs["canvas-holder"].focus(),s.beginPath(),s.moveTo(c,r),s.lineTo(n.offsetX,n.offsetY),s.strokeStyle=this.brushType=="del"?"black":"white",s.lineWidth=8,s.lineCap="round",s.stroke(),this.updateBlend(),[c,r]=[n.offsetX,n.offsetY])}),e.addEventListener("mouseup",()=>{this.isDrawing=!1}),t.addEventListener("mouseout",()=>{this.isDrawing=!1})},updateBlend(){if(this.haveImage)try{const t=G(this.$refs.maskCanvas,"float32");b.blur(t,t,new b.Size(2,2));const e=x(this.imageHolder.originalImage,t);E(this.$refs.outputCanvas,e),e.delete(),t.delete()}catch(t){alert(String(t?.message||t)),console.error(t)}},previewImage(t){const e=x(this.imageHolder.originalImage,t);b.cvtColor(e,e,b.COLOR_BGRA2RGBA);const s=X(e);this.$refs.preview.src=s,e.delete()},setImage(t,e){if(this.checkpoints=[],this.isDrawing=!1,this.imageHolder?.originalImage?.delete?.(),this.haveImage=!0,this.imageHolder.originalImage=t,this.$root.$isMobile()){this.previewImage(e),e.delete();return}const s=this.$refs.outputCanvas,c=this.$refs.maskCanvas,r=x(t,e);E(s,r),E(c,e),r.delete(),e.delete()}},props:{}},q={class:"align-self-center"},Y={key:0},Z={class:"p-3 border-round-2xl col-11 md:col-5 align-items-center m-auto shadow-3",style:{background:"white",border:"solid 1.2px #e1e1e1"}},N={class:"flex justify-content-center",style:{gap:"15px"}},W={class:"no-drag-no-select",ref:"outputCanvas"},J={class:"no-drag-no-select",style:{display:"none"},ref:"maskCanvas"},Q={key:1},ee={ref:"preview",style:{width:"500px",height:"500px",background:"url('./images/download.png')","object-fit":"scale-down"}};function te(t,e,s,c,r,n){const o=$("Button");return j((h(),f("div",q,[e[6]||(e[6]=l("div",{class:"py-2"},null,-1)),t.$root.$isMobile()?(h(),f("div",Q,[l("img",ee,null,512),e[5]||(e[5]=l("div",{class:"py-2"},null,-1)),A(o,{label:"Save",size:"large",onClick:n.saveFromPreview,class:"border-round-2xl",icon:"pi pi-save"},null,8,["onClick"])])):(h(),f("div",Y,[l("div",Z,[l("div",N,[l("div",null,[l("i",{onClick:e[0]||(e[0]=v=>{r.brushType="del",r.isDrawing=!1}),style:y([r.brushType=="del"?"color:blue":"",{"font-size":"x-large"}]),class:"pi pi-eraser cursor-pointer"},null,4)]),l("div",null,[l("i",{onClick:e[1]||(e[1]=v=>{r.brushType="paint",r.isDrawing=!1}),style:y([r.brushType!="del"?"color:blue":"",{"font-size":"x-large"}]),class:"pi pi-pencil cursor-pointer"},null,4)]),l("div",null,[l("i",{style:y([r.checkpoints.length>0?"cursor:pointer":"",{"font-size":"x-large"}]),onClick:e[2]||(e[2]=(...v)=>n.revertLastOp&&n.revertLastOp(...v)),class:"pi pi-undo"},null,4)]),l("div",null,[l("i",{style:{"font-size":"x-large"},onClick:e[3]||(e[3]=(...v)=>n.save&&n.save(...v)),class:"pi pi-save cursor-pointer"})])])]),e[4]||(e[4]=l("div",{class:"py-1"},null,-1)),l("div",{ref:"canvas-holder",style:y([{overflow:"auto",position:"relative","min-height":"500px",background:"url('./images/download.png')"},t.$root.$grid.lg?"width:84vw":"width:100vw"]),class:"border-round-2xl shadow-1"},[l("canvas",W,null,512),l("canvas",J,null,512)],4)]))],512)),[[U,r.haveImage]])}const me=k(V,[["render",te]]),se={data(){return{status:"",val:0,show:!1}},unmounted(){K.Instance.unsubscribeEmitter("modelLoading")},mounted(){K.Instance.subscribeEmitter("modelLoading",(t,e)=>{switch(t){case"download":{this.show=!0,this.val=Math.trunc(parseFloat(e)),this.status="Downloading model..";break}case"message":{this.status=e;break}case"finish":{this.show=!1;break}}})}},ne={key:0,class:"overlay"},oe={class:"inner-overlay col-11 md:col-7 p-4",style:{height:"70vh",border:"2px solid black",background:"white","border-radius":"15px"}},re={style:{"font-weight":"bold"}};function ie(t,e,s,c,r,n){const o=$("ProgressBar");return r.show?(h(),f("div",ne,[l("div",oe,[l("p",re,S(r.status),1),e[0]||(e[0]=l("div",{class:"py-1"},null,-1)),A(o,{style:{height:"30px","border-radius":"20px"},value:r.val},null,8,["value"])])])):O("",!0)}const we=k(se,[["render",ie],["__scopeId","data-v-2334895f"]]),ae={data(){return{isDragging:!1}},emits:["onFile"],methods:{triggerFileInput(){this.$refs.fileInput.click()},handleFiles(t){let e;"dataTransfer"in t?e=t.dataTransfer.files[0]:(e=t.target.files[0],this.$refs.fileInput.value=""),e&&this.$emit("onFile",e)},dragOver(){this.isDragging=!0},dragLeave(){this.isDragging=!1},handleDrop(t){this.isDragging=!1,this.handleFiles(t)}}};function le(t,e,s,c,r,n){return h(),f("div",null,[l("input",{type:"file",ref:"fileInput",onChange:e[0]||(e[0]=(...o)=>n.handleFiles&&n.handleFiles(...o)),accept:"image/*",style:{display:"none"}},null,544),l("div",{id:"drop-area",onClick:e[1]||(e[1]=(...o)=>n.triggerFileInput&&n.triggerFileInput(...o)),onDragover:e[2]||(e[2]=B((...o)=>n.dragOver&&n.dragOver(...o),["prevent"])),onDragleave:e[3]||(e[3]=(...o)=>n.dragLeave&&n.dragLeave(...o)),onDrop:e[4]||(e[4]=B((...o)=>n.handleDrop&&n.handleDrop(...o),["prevent"])),class:H({hover:r.isDragging})},e[5]||(e[5]=[l("p",null,"Drag and drop an image here or click to upload",-1)]),34)])}const ye=k(ae,[["render",le]]),de=P({name:"samples",emits:["onItem"]}),ce=""+new URL("../images/008.jpg",import.meta.url).href,ue=""+new URL("../images/009.jpg",import.meta.url).href,pe=""+new URL("../images/elon_musk.webp",import.meta.url).href,ve={class:"flex justify-content-center gap-2 align-self-center align-items-center flex-wrap p-3 border-round-2xl shadow-1",style:{background:"white",border:"solid 1.2px #e7e7e7"}};function he(t,e,s,c,r,n){return h(),f("div",ve,[l("img",{onClick:e[0]||(e[0]=o=>t.$emit("onItem",o.target.src)),class:"border-round-2xl cursor-pointer",style:{width:"100px",height:"200px","object-fit":"cover"},src:ce}),l("img",{onClick:e[1]||(e[1]=o=>t.$emit("onItem",o.target.src)),class:"border-round-2xl cursor-pointer",style:{width:"100px",height:"200px","object-fit":"cover"},src:ue}),l("img",{onClick:e[2]||(e[2]=o=>t.$emit("onItem",o.target.src)),class:"border-round-2xl cursor-pointer",style:{width:"100px",height:"200px","object-fit":"cover"},src:pe})])}const be=k(de,[["render",he]]);export{me as M,we as P,be as S,ye as U};
